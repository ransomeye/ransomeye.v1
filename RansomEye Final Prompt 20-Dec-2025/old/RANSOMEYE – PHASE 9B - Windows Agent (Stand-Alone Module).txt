# ğŸªŸ RANSOMEYE â€“ PHASE 9B

## Windows Agent (Stand-Alone Module)

### **(PROMPT NUMBER 9B OF 12)**

**MASTER PROMPT â€“ CURSOR EXECUTION**

---

## CONTEXT (STAND-ALONE MODULE â€“ CRITICAL)

You are building the **RansomEye Windows Agent**.

This agent is a **fully stand-alone deployable component**, independently installable, upgradeable, and removable, with **no runtime dependency on Python**.

The Windows Agent must:

* Run on **supported Windows Server and Desktop versions**
* Use **native Windows telemetry mechanisms**
* Be **fail-closed**
* Operate in **restricted, enterprise-hardened environments**
* Function in **offline / air-gapped deployments**

This agent operates at a **high-risk trust boundary** and must assume:

* The endpoint may already be partially compromised
* Network conditions are hostile
* Privileges may be reduced at runtime

---

## ğŸš¨ ABSOLUTE LANGUAGE RULES

### âœ… ALLOWED LANGUAGES

* **Rust (MANDATORY, PRIMARY)**
* **C++ (MANDATORY for Windows-native subsystems)**

### âŒ FORBIDDEN LANGUAGES

* Python
* Java
* Go
* NodeJS
* PowerShell as core logic
* Any interpreter-based runtime

â¡ï¸ Any violation = **INVALID OUTPUT**

---

## ğŸš« LICENSE RULES (STRICT)

Allowed only:

* MIT
* BSD
* Apache 2.0
* Microsoft Windows SDK / OS EULA

BANNED:

* GPL / AGPL / SSPL
* Unknown or ambiguous licenses
* Copyleft userland libraries

---

## ğŸ¯ PHASE 9B OBJECTIVE

Build a **native, low-overhead, cryptographically secured Windows Agent** that:

1. Collects deep host telemetry using native APIs
2. Observes ransomware-relevant behaviors
3. Executes enforcement actions **only when explicitly instructed**
4. Maintains a strong cryptographic identity
5. Survives reboots, updates, and partial failures
6. Never makes autonomous policy decisions

---

## ğŸ“¦ WINDOWS AGENT RESPONSIBILITIES (STRICT)

### MUST DO

* Process and thread telemetry
* File system activity monitoring
* Registry activity monitoring
* ETW-based event capture
* Memory and handle observation (metadata only)
* Secure communication with Core
* Signed enforcement execution
* Self-integrity and tamper detection

### MUST NEVER DO

* Correlate multi-host data
* Train or run ML models
* Make autonomous decisions
* Execute unsigned instructions
* Depend on external runtimes

---

## ğŸ“ PHASE 9B FOLDER STRUCTURE (MANDATORY)

You MUST create and explain:

```
agents/
â””â”€â”€ windows/
    â”œâ”€â”€ src/
    â”‚   â”œâ”€â”€ main.rs
    â”‚   â”œâ”€â”€ agent.rs
    â”‚   â”œâ”€â”€ lifecycle.rs
    â”‚   â”œâ”€â”€ telemetry/
    â”‚   â”‚   â”œâ”€â”€ mod.rs
    â”‚   â”‚   â”œâ”€â”€ process.cpp
    â”‚   â”‚   â”œâ”€â”€ filesystem.cpp
    â”‚   â”‚   â”œâ”€â”€ registry.cpp
    â”‚   â”‚   â”œâ”€â”€ etw.cpp
    â”‚   â”‚   â””â”€â”€ memory.cpp
    â”‚   â”‚
    â”‚   â”œâ”€â”€ enforcement/
    â”‚   â”‚   â”œâ”€â”€ mod.rs
    â”‚   â”‚   â”œâ”€â”€ actions.rs
    â”‚   â”‚   â””â”€â”€ safeguards.rs
    â”‚   â”‚
    â”‚   â”œâ”€â”€ security/
    â”‚   â”‚   â”œâ”€â”€ identity.rs
    â”‚   â”‚   â”œâ”€â”€ verification.rs
    â”‚   â”‚   â””â”€â”€ integrity.rs
    â”‚   â”‚
    â”‚   â”œâ”€â”€ comms/
    â”‚   â”‚   â”œâ”€â”€ protocol.rs
    â”‚   â”‚   â”œâ”€â”€ encryption.rs
    â”‚   â”‚   â””â”€â”€ retry.rs
    â”‚   â”‚
    â”‚   â”œâ”€â”€ config/
    â”‚   â”‚   â””â”€â”€ validation.rs
    â”‚   â”‚
    â”‚   â””â”€â”€ errors/
    â”‚       â””â”€â”€ agent_errors.rs
    â”‚
    â”œâ”€â”€ installer/
    â”‚   â”œâ”€â”€ msi/
    â”‚   â”œâ”€â”€ service/
    â”‚   â”‚   â””â”€â”€ ransomeye-windows-agent.service
    â”‚   â””â”€â”€ upgrade.md
    â”‚
    â”œâ”€â”€ docs/
    â”‚   â”œâ”€â”€ telemetry_model.md
    â”‚   â”œâ”€â”€ enforcement_model.md
    â”‚   â”œâ”€â”€ etw_usage.md
    â”‚   â”œâ”€â”€ failure_modes.md
    â”‚   â””â”€â”€ security_model.md
    â”‚
    â””â”€â”€ tests/
        â”œâ”€â”€ synthetic_telemetry.rs
        â”œâ”€â”€ enforcement_tests.rs
        â”œâ”€â”€ tamper_tests.rs
        â”œâ”€â”€ privilege_drop_tests.rs
        â””â”€â”€ recovery_tests.rs
```

You MUST explain:

* Why Rust vs C++ is used in each area
* How FFI boundaries are secured
* What is forbidden in each module

---

## ğŸ” IDENTITY & TRUST (MANDATORY)

You MUST implement:

* Per-agent cryptographic identity
* Secure enrollment and bootstrap
* Mutual authentication with Core
* Command signature verification
* Revocation and expiration handling

Any verification failure = **REFUSE EXECUTION**

---

## ğŸ“Š TELEMETRY MODEL

You MUST define:

* Telemetry categories (process, FS, registry, ETW, memory)
* Event normalization
* Rate limiting
* Backpressure handling
* Privacy and data minimization rules

No raw memory dumps.
No credential harvesting.
Metadata only.

---

## ğŸ›¡ï¸ ENFORCEMENT MODEL (STRICT)

Enforcement actions:

* Must be **explicit**
* Must be **signed**
* Must be **scoped**
* Must be **time-bounded**
* Must be **reversible**

Agent must refuse:

* Unsigned actions
* Over-broad scopes
* Actions violating host safety

---

## ğŸ’¥ FAILURE MODES (MANDATORY)

Define behavior for:

* ETW provider failure
* Privilege reduction
* Service restart
* Disk exhaustion
* Network isolation
* Identity expiration
* Binary tampering

Agent must:

* Remain observable
* Avoid OS instability
* Fail safely without blocking Windows

---

## ğŸ§ª TESTING REQUIREMENTS

You MUST include:

* Synthetic telemetry generators
* ETW failure simulations
* Enforcement safety tests
* Tamper and integrity tests
* Offline operation tests
* Upgrade / rollback tests

---

## ğŸ“¤ EXPECTED OUTPUT

You must output:

1. Windows Agent architecture
2. Folder structure explanation
3. Telemetry model
4. ETW integration design
5. Enforcement safeguards
6. Identity & trust flow
7. Failure handling matrix
8. Test strategy

---

## ğŸ›‘ FAILURE CONDITIONS

Your output is INVALID if:

* Python is used anywhere
* ETW is replaced by polling
* Commands are unsigned
* Agent trusts Core blindly
* Enforcement is implicit
* License ambiguity exists

---

## FINAL INSTRUCTION

Treat the Windows Agent as:

* A high-value target
* A low-trust environment component
* A security-sensitive service

Design it to survive:

* Endpoint compromise attempts
* Privilege fluctuations
* Operator misconfiguration

**BUILD PHASE 9B COMPLETELY, STRICTLY, AND NATIVELY.**

---

### ğŸ”¢ PROMPT STATUS

**This was PROMPT NUMBER 9B OF 12**

