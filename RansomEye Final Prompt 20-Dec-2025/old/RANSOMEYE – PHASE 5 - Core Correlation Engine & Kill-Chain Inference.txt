# ğŸ§© RANSOMEYE â€“ PHASE 5

## Core Correlation Engine & Kill-Chain Inference

### **(PROMPT NUMBER 5 OF 12)**

**MASTER PROMPT â€“ CURSOR EXECUTION**

---

## CONTEXT (CRITICAL â€“ READ FIRST)

You are now building the **CORE BRAIN of RansomEye**.

This phase determines:

* Detection accuracy
* Latency
* Explainability
* Determinism
* Scale behavior at **50,000+ endpoints**

Any architectural or language mistake here:

* Creates GC pauses
* Introduces race conditions
* Breaks explainability
* Makes enforcement non-deterministic

This component is **security-critical**.

---

## ğŸš¨ ABSOLUTE LANGUAGE RULES

### âœ… ALLOWED LANGUAGES

* **Rust (MANDATORY, PRIMARY)**

### âŒ FORBIDDEN LANGUAGES

* Python
* Java
* Go
* NodeJS
* JVM-based languages
* Any GC-based runtime

â¡ï¸ Any violation = **INVALID OUTPUT**

---

## ğŸš« LICENSE RULES

* GPL / AGPL / SSPL â†’ **BANNED**
* Unknown licenses â†’ **BANNED**

Allowed only:

* MIT
* BSD
* Apache 2.0

---

## ğŸ¯ PHASE 5 OBJECTIVE

Build a **deterministic, explainable, high-performance correlation engine** that:

1. Correlates multi-source telemetry
2. Infers ransomware kill-chain stages
3. Produces **explainable decisions**
4. Feeds **Policy Engine** (no enforcement here)
5. Operates under sustained high event volume

This engine **does not**:

* Enforce policy
* Block traffic
* Perform AI inference
* Trust upstream data blindly

---

## ğŸ“¦ CORE RESPONSIBILITIES (STRICT)

### MUST DO

* Temporal correlation
* Cross-signal correlation
* State tracking per entity
* Kill-chain stage inference
* Confidence scoring
* Explainability metadata generation

### MUST NEVER DO

* Execute response actions
* Block events
* Invoke AI/ML models
* Persist long-term data
* Accept unverified events

---

## ğŸ“ PHASE 5 FOLDER STRUCTURE (MANDATORY)

You MUST create and explain:

```
core/
â”œâ”€â”€ correlation/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ lib.rs
â”‚   â”‚   â”œâ”€â”€ engine.rs
â”‚   â”‚   â”œâ”€â”€ scheduler.rs
â”‚   â”‚   â”œâ”€â”€ entity_state.rs
â”‚   â”‚   â”œâ”€â”€ temporal.rs
â”‚   â”‚   â”œâ”€â”€ graph.rs
â”‚   â”‚   â”œâ”€â”€ scoring.rs
â”‚   â”‚   â””â”€â”€ explainability.rs
â”‚   â”‚
â”‚   â”œâ”€â”€ kill_chain/
â”‚   â”‚   â”œâ”€â”€ stages.rs
â”‚   â”‚   â”œâ”€â”€ transitions.rs
â”‚   â”‚   â””â”€â”€ inference.rs
â”‚   â”‚
â”‚   â”œâ”€â”€ input/
â”‚   â”‚   â”œâ”€â”€ validated_events.rs
â”‚   â”‚   â””â”€â”€ normalization.rs
â”‚   â”‚
â”‚   â”œâ”€â”€ output/
â”‚   â”‚   â”œâ”€â”€ correlation_result.rs
â”‚   â”‚   â””â”€â”€ confidence.rs
â”‚   â”‚
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ validation.rs
â”‚   â”‚
â”‚   â””â”€â”€ errors/
â”‚       â””â”€â”€ correlation_errors.rs
â”‚
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ correlation_model.md
â”‚   â”œâ”€â”€ kill_chain_model.md
â”‚   â”œâ”€â”€ explainability.md
â”‚   â”œâ”€â”€ performance_model.md
â”‚   â””â”€â”€ failure_modes.md
â”‚
â””â”€â”€ tests/
    â”œâ”€â”€ synthetic_events.rs
    â”œâ”€â”€ high_volume_tests.rs
    â”œâ”€â”€ ordering_tests.rs
    â”œâ”€â”€ race_condition_tests.rs
    â””â”€â”€ explainability_tests.rs
```

---

## ğŸ”€ CORRELATION PIPELINE (STEP-BY-STEP)

You MUST define:

1. Validated event intake
2. Entity identification
3. Temporal windowing
4. Cross-source correlation
5. Graph construction
6. Kill-chain stage inference
7. Confidence scoring
8. Explainability artifact generation
9. Output to Policy Engine

Each step must specify:

* Inputs
* Outputs
* State changes
* Failure behavior
* Performance implications

---

## ğŸ§  KILL-CHAIN MODEL (MANDATORY)

You MUST define:

* Kill-chain stages
* Entry conditions
* Transition rules
* Regressions and loops
* Confidence decay
* False-positive mitigation

No generic models allowed â€” ransomware-specific.

---

## âš™ï¸ PERFORMANCE & SCALING MODEL

You MUST define:

* Event throughput handling
* Memory bounds per entity
* Eviction strategy
* Lock-free or low-lock design
* Scheduler fairness

ğŸš« DO NOT:

* Use global locks
* Block ingestion threads
* Assume infinite memory

---

## ğŸ” SECURITY & TRUST

* Accept events only from Phase 4 ingestion
* Reject malformed or unsigned data
* Fail-closed on state corruption
* No implicit trust of inputs

---

## ğŸ’¥ FAILURE MODES (REQUIRED)

Define behavior for:

* Event floods
* Out-of-order events
* Entity explosion
* Memory pressure
* Internal state corruption

---

## ğŸ§ª TESTING REQUIREMENTS

You MUST include:

* Synthetic ransomware scenarios
* Benign burst scenarios
* Edge-case timing attacks
* Explainability verification
* Determinism checks

---

## ğŸ“¤ EXPECTED OUTPUT

You must output:

1. Correlation engine architecture
2. Folder structure explanation
3. Kill-chain model
4. Explainability design
5. Performance model
6. Failure handling matrix
7. Test strategy

---

## ğŸ›‘ FAILURE CONDITIONS

Your output is INVALID if:

* Python appears anywhere
* AI/ML models are invoked
* Enforcement actions occur
* Explainability is vague
* State handling is implicit
* Determinism is not guaranteed

---

## FINAL INSTRUCTION

This engine is the **authoritative source of truth** for detection.

Design it as if:

* Attackers attempt to confuse it
* Events arrive out of order
* Scale increases 10Ã— overnight

**BUILD PHASE 5 COMPLETELY, STRICTLY, AND DETERMINISTICALLY.**

---

### ğŸ”¢ PROMPT STATUS

**This was PROMPT NUMBER 5 OF 12**
