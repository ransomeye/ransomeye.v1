# ğŸ§  RANSOMEYE â€” PHASE 5

## Core Correlation Engine, Kill-Chain Inference & Deterministic Detection

### **(AUTHORITATIVE MASTER PROMPT â€“ PHASE 5)**

**Environment Root:** `/home/ransomeye/rebuild/`
**Phase Folder:** `/home/ransomeye/rebuild/ransomeye_core/`

---

## CONTEXT (SECURITY-CRITICAL)

This phase builds the **Core Correlation Engine**, which is the **only component allowed to infer â€œattack realityâ€**.

This engine:

* Receives only **validated events from Phase 4**
* Operates **deterministically**
* Implements **formal ransomware kill-chain logic**
* Produces **authoritative detection outputs**
* Feeds **Policy Engine (Phase 6)**

If this phase is wrong:

* False positives explode
* Attacks are missed
* Enforcement becomes arbitrary
* Military-grade claims fail

**This phase MUST NOT depend on AI/ML/LLM to function.**
AI is **assistive context only**, never authoritative.

---

## ğŸš¨ GLOBAL RULES (RE-ENFORCED)

All rules from **Phase 1â€“4** apply unchanged.

Additional Phase-5 rules below are **hard enforcement**.

---

## ğŸ¯ PHASE 5 OBJECTIVE

Build a **deterministic, explainable, formally bounded correlation engine** that:

1. Correlates multi-source telemetry
2. Tracks entity state over time
3. Implements a **formal ransomware kill-chain**
4. Infers attack progression deterministically
5. Produces confidence-scored detection outputs
6. Emits explainability artifacts
7. Operates at **50,000+ endpoints scale**

---

## ğŸ“¦ RESPONSIBILITY BOUNDARIES (STRICT)

### MUST DO

* Temporal correlation
* Cross-signal correlation
* Entity state tracking
* Kill-chain stage inference
* Deterministic scoring
* Explainability generation
* Bounded memory management

### MUST NEVER DO

* Enforce policy
* Block traffic
* Execute response actions
* Invoke AI/ML/LLM for decisions
* Trust upstream data implicitly
* Learn at runtime

---

## ğŸ“ PHASE 5 DIRECTORY STRUCTURE (MANDATORY)

Create exactly:

```
/home/ransomeye/rebuild/ransomeye_core/
```

```
ransomeye_core/
â”œâ”€â”€ correlation/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ lib.rs
â”‚   â”‚   â”œâ”€â”€ engine.rs
â”‚   â”‚   â”œâ”€â”€ scheduler.rs
â”‚   â”‚   â”œâ”€â”€ entity_state.rs
â”‚   â”‚   â”œâ”€â”€ temporal.rs
â”‚   â”‚   â”œâ”€â”€ graph.rs
â”‚   â”‚   â”œâ”€â”€ scoring.rs
â”‚   â”‚   â”œâ”€â”€ explainability.rs
â”‚   â”‚   â””â”€â”€ invariants.rs
â”‚   â”‚
â”‚   â”œâ”€â”€ kill_chain/
â”‚   â”‚   â”œâ”€â”€ stages.rs
â”‚   â”‚   â”œâ”€â”€ transitions.rs
â”‚   â”‚   â”œâ”€â”€ rules.rs
â”‚   â”‚   â””â”€â”€ inference.rs
â”‚   â”‚
â”‚   â”œâ”€â”€ input/
â”‚   â”‚   â”œâ”€â”€ validated_events.rs
â”‚   â”‚   â””â”€â”€ normalization.rs
â”‚   â”‚
â”‚   â”œâ”€â”€ output/
â”‚   â”‚   â”œâ”€â”€ detection_result.rs
â”‚   â”‚   â”œâ”€â”€ confidence.rs
â”‚   â”‚   â””â”€â”€ rationale.rs
â”‚   â”‚
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ validation.rs
â”‚   â”‚
â”‚   â””â”€â”€ errors/
â”‚       â””â”€â”€ correlation_errors.rs
â”‚
â”œâ”€â”€ intelligence_adapter/
â”‚   â”œâ”€â”€ threat_context.rs
â”‚   â”œâ”€â”€ ai_context.rs
â”‚   â””â”€â”€ validation.rs
â”‚
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ correlation_model.md
â”‚   â”œâ”€â”€ kill_chain_model.md
â”‚   â”œâ”€â”€ invariants.md
â”‚   â”œâ”€â”€ performance_model.md
â”‚   â””â”€â”€ failure_modes.md
â”‚
â””â”€â”€ tests/
    â”œâ”€â”€ synthetic_attack_tests.rs
    â”œâ”€â”€ false_positive_tests.rs
    â”œâ”€â”€ ordering_tests.rs
    â”œâ”€â”€ scale_tests.rs
    â”œâ”€â”€ invariant_violation_tests.rs
    â””â”€â”€ determinism_tests.rs
```

---

## ğŸ§¬ FORMAL KILL-CHAIN MODEL (MANDATORY)

You MUST implement a **formal ransomware-specific kill-chain**, including at minimum:

* Initial access
* Execution
* Persistence
* Privilege escalation
* Lateral movement
* Credential access
* Discovery
* Encryption preparation
* Encryption execution
* Impact

Each stage MUST define:

* Entry conditions
* Required signals
* Temporal constraints
* Allowed transitions
* Regression rules
* Confidence decay

No generic â€œMITRE-onlyâ€ mapping.
This must be ransomware-specific and codified.

---

## ğŸ§  DETERMINISM & INVARIANTS (CRITICAL)

You MUST define and enforce **hard invariants**, such as:

* No stage skip without evidence
* No confidence increase without new signal
* No detection without minimum signal set
* No state explosion without eviction

Violating an invariant â†’ **FAIL CLOSED + AUDIT LOG**

---

## âš™ï¸ PERFORMANCE & SCALE MODEL

You MUST explicitly define:

* Event throughput limits
* Memory bounds per entity
* Eviction strategy
* Lock-free or low-lock design
* Scheduler fairness
* Backpressure interaction with Phase 4

No unbounded maps.
No global locks.

---

## ğŸ” EXPLAINABILITY (MANDATORY)

For every detection result, you MUST emit:

* Signals involved
* Kill-chain stages triggered
* Temporal sequence
* Confidence calculation
* Intelligence context used (if any)

Explainability must be:

* Human readable
* Machine readable
* Deterministic

---

## ğŸ§  INTELLIGENCE USAGE (STRICT)

Allowed:

* Threat intel as context
* AI confidence hints
* Baseline anomaly context

Forbidden:

* AI overriding correlation
* AI injecting detections
* AI altering state transitions

If intelligence is unavailable:
â¡ï¸ Core MUST continue functioning.

---

## ğŸ’¥ FAILURE MODES (MANDATORY)

Define explicit behavior for:

* Event floods
* Out-of-order events
* Entity explosion
* Memory pressure
* Internal state corruption
* Downstream unavailability

Failures must:

* Preserve correctness
* Avoid false detection
* Remain observable

---

## ğŸ§ª VALIDATION REQUIREMENTS

You MUST include tests that:

* Replay synthetic ransomware campaigns
* Verify determinism
* Validate invariants
* Test scale limits (50k+ entities)
* Confirm explainability completeness

---

## ğŸ›‘ FAILURE CONDITIONS (HARD)

Phase 5 is INVALID if:

* AI influences decisions
* Kill-chain is implicit
* Determinism is not provable
* Invariants are undocumented
* Memory is unbounded
* Correlation logic is heuristic-only

---

## FINAL INSTRUCTION

Treat Phase 5 as:

* A **formal reasoning engine**
* A **court-defensible detector**
* A **zero-guessing brain**

If Phase 5 is weak, **everything downstream is unsafe**.

**BUILD PHASE 5 COMPLETELY, EXPLICITLY, AND WITHOUT ASSUMPTIONS.**

---
