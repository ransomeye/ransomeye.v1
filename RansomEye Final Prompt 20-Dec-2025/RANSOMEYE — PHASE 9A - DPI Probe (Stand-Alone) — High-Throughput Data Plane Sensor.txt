# ğŸ“¡ RANSOMEYE â€” PHASE 9A

## DPI Probe (Stand-Alone) â€” High-Throughput Data Plane Sensor

### **(AUTHORITATIVE MASTER PROMPT â€“ PHASE 9A)**

**Environment Root:** `/home/ransomeye/rebuild/`
**Phase Folder:** `/home/ransomeye/rebuild/ransomeye_dpi_probe/`

---

## CONTEXT (DATA PLANE, HOSTILE ENVIRONMENT)

The DPI Probe is a **stand-alone, untrusted-input sensor** operating at **line rate (40+ Gbps)**.
It **never decides**, **never enforces**, and **never stores long-term state**.

Assumptions:

* Traffic is hostile
* NICs are saturated
* CPUs are NUMA
* Memory pressure exists
* Kernel features vary across Linux versions

The DPI Probe must protect itself and the Core by **sampling, normalizing, and streaming metadata only**.

---

## ğŸš¨ GLOBAL RULES (RE-ENFORCED)

All rules from **Phase 1â€“8** apply unchanged.

Additional Phase-9A rules below are **hard enforcement**.

---

## ğŸ¯ PHASE 9A OBJECTIVE

Build a **GPL-free, Linux-agnostic, ultra-high-performance DPI Probe** that:

1. Captures packets at line rate
2. Reconstructs flows/sessions (bounded)
3. Extracts metadata (no payload storage)
4. Generates **signed events** only
5. Applies deterministic backpressure
6. Streams to Core Ingestion (Phase 4)
7. Enforces **SWAP policy** at startup
8. Operates without Python or GC

---

## ğŸš« LICENSE & LANGUAGE RULES (STRICT)

### Languages (ONLY)

* **Rust (PRIMARY)**
* **C++ (ONLY if unavoidable for perf)**
* **eBPF (kernel space only)**

### Forbidden

* Python
* Go
* Java
* NodeJS
* Scapy
* Any GPL userland library

### Allowed Libraries

* libpcap (BSD)
* AF_XDP
* Hyperscan (BSD)
* MIT/BSD/Apache crates only

---

## ğŸ’¾ SWAP MEMORY POLICY (MANDATORY)

Applicable **ONLY** to:

* DPI Probe
* Core Engine

Rules:

* Minimum SWAP: **16 GB**
* OR **equal to physical RAM**, whichever is higher
* Automatically created during install
* Verified at startup
* Missing/insufficient SWAP â†’ **FAIL STARTUP**

Explicitly **FORBIDDEN** for:

* Linux Agent
* Windows Agent

---

## ğŸ“¦ RESPONSIBILITY BOUNDARIES (STRICT)

### MUST DO

* Packet capture
* Flow/session tracking (bounded)
* Metadata extraction (headers, TLS FP, timing)
* Event signing
* Rate limiting
* Backpressure signaling
* Self-identity verification

### MUST NEVER DO

* Payload storage
* Policy enforcement
* AI inference
* Traffic blocking
* Database writes
* Trust upstream/downstream blindly

---

## ğŸ“ PHASE 9A DIRECTORY STRUCTURE (MANDATORY)

Create exactly:

```
/home/ransomeye/rebuild/ransomeye_dpi_probe/
```

```
ransomeye_dpi_probe/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.rs
â”‚   â”œâ”€â”€ capture/
â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â”œâ”€â”€ pcap.rs
â”‚   â”‚   â”œâ”€â”€ af_xdp.rs
â”‚   â”‚   â””â”€â”€ interface.rs
â”‚   â”‚
â”‚   â”œâ”€â”€ pipeline/
â”‚   â”‚   â”œâ”€â”€ packet_decoder.rs
â”‚   â”‚   â”œâ”€â”€ flow_tracker.rs
â”‚   â”‚   â”œâ”€â”€ session_reassembly.rs
â”‚   â”‚   â””â”€â”€ metadata_extractor.rs
â”‚   â”‚
â”‚   â”œâ”€â”€ threading/
â”‚   â”‚   â”œâ”€â”€ cpu_pinning.rs
â”‚   â”‚   â”œâ”€â”€ numa.rs
â”‚   â”‚   â””â”€â”€ backpressure.rs
â”‚   â”‚
â”‚   â”œâ”€â”€ output/
â”‚   â”‚   â”œâ”€â”€ event_schema.rs
â”‚   â”‚   â”œâ”€â”€ serializer.rs
â”‚   â”‚   â””â”€â”€ secure_stream.rs
â”‚   â”‚
â”‚   â”œâ”€â”€ security/
â”‚   â”‚   â”œâ”€â”€ identity.rs
â”‚   â”‚   â”œâ”€â”€ attestation.rs
â”‚   â”‚   â””â”€â”€ signing.rs
â”‚   â”‚
â”‚   â”œâ”€â”€ system/
â”‚   â”‚   â”œâ”€â”€ swap_check.rs
â”‚   â”‚   â””â”€â”€ env_validation.rs
â”‚   â”‚
â”‚   â””â”€â”€ errors/
â”‚       â””â”€â”€ dpi_errors.rs
â”‚
â”œâ”€â”€ ebpf/
â”‚   â”œâ”€â”€ xdp_program.c
â”‚   â”œâ”€â”€ maps.h
â”‚   â””â”€â”€ loader.rs
â”‚
â”œâ”€â”€ systemd/
â”‚   â””â”€â”€ ransomeye-dpi-probe.service
â”‚
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ packet_pipeline.md
â”‚   â”œâ”€â”€ threading_model.md
â”‚   â”œâ”€â”€ memory_model.md
â”‚   â”œâ”€â”€ swap_policy.md
â”‚   â”œâ”€â”€ kernel_compatibility.md
â”‚   â””â”€â”€ failure_modes.md
â”‚
â””â”€â”€ tests/
    â”œâ”€â”€ synthetic_packets.rs
    â”œâ”€â”€ throughput_40gbps.rs
    â”œâ”€â”€ backpressure_tests.rs
    â”œâ”€â”€ swap_enforcement_tests.rs
    â””â”€â”€ tamper_tests.rs
```

---

## âš™ï¸ PERFORMANCE & THREADING MODEL (MANDATORY)

You MUST define and implement:

* Per-CPU worker threads
* CPU pinning
* NUMA locality
* Zero-copy buffers
* Lock-free queues
* Fixed memory pools

ğŸš« No per-packet allocation
ğŸš« No global locks
ğŸš« No unbounded buffers

---

## ğŸ”€ PACKET â†’ EVENT PIPELINE (EXPLICIT)

Define step-by-step:

1. NIC â†’ Kernel (AF_XDP/libpcap)
2. Kernel â†’ Userland
3. Packet decode
4. Flow/session tracking
5. Metadata extraction
6. Event normalization
7. Signature generation
8. Secure stream to Phase 4

Each step must specify:

* Input
* Output
* Failure behavior
* Performance impact

---

## ğŸ” IDENTITY & TRUST (MANDATORY)

* Unique cryptographic identity per probe
* Mutual auth with Core ingestion
* Attestation before streaming
* Signature on every event
* Replay protection

Failure â†’ **STOP STREAMING**

---

## ğŸ§  AI / ML / LLM (STRICTLY ADVISORY)

DPI Probe:

* **DOES NOT RUN AI**
* **DOES NOT INFER**
* **DOES NOT SCORE**

Allowed:

* Embedding metadata fields required by AI later
* Feature-ready extraction only

---

## ğŸ’¥ FAILURE MODES (MANDATORY)

Define behavior for:

* Packet overload
* CPU starvation
* Memory pressure
* Swap missing
* Core unreachable
* Identity invalid
* Kernel feature missing

Failures must:

* Be observable
* Be safe
* Avoid packet corruption
* Never block traffic

---

## ğŸ§ª VALIDATION REQUIREMENTS

You MUST include tests that:

* Prove 40+ Gbps sustained ingest (synthetic)
* Validate swap enforcement
* Detect signature tampering
* Validate backpressure
* Validate kernel compatibility

---

## ğŸ›‘ FAILURE CONDITIONS (HARD)

Phase 9A is INVALID if:

* GPL appears anywhere
* Swap is optional
* Python exists
* DPI enforces policy
* Packets are stored
* Silent drops exist

---

## FINAL INSTRUCTION

Treat Phase 9A as:

* A **carrier-grade sensor**
* A **blast-shield**
* A **data-plane appliance**

If DPI fails, **Core must survive**.

**BUILD PHASE 9A COMPLETELY, EXPLICITLY, AND WITHOUT ASSUMPTIONS.**

---
